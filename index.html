<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Diabetes Research Feedback</title>
    
    <!-- React and ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
        }
        input, textarea, select, button {
            font-size: 16px !important;
        }
        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 8px;
            background-color: #006400;
            border-bottom: 1px solid #ddd;
        }
        .logo {
            height: 40px;
            width: auto;
            object-fit: contain;
        }
        .messages {
            flex-grow: 1;
            overflow-y: auto;
            padding: 10px;
        }
        .message {
            margin: 10px 0;
            padding: 10px;
            border-radius: 8px;
            max-width: 80%;
            white-space: pre-wrap;
        }
        .user-message {
            background-color: #dcf8c6;
            margin-left: auto;
        }
        .bot-message {
            background-color: white;
        }
        .input-container {
            display: flex;
            padding: 10px;
            background-color: white;
            border-top: 1px solid #ddd;
        }
        .input-container input {
            flex-grow: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 20px;
            margin-right: 8px;
        }
        .input-container button {
            padding: 8px 16px;
            background-color: #128C7E;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
        }
        @media screen and (max-width: 768px) {
            body {
                padding: 10px;
                height: -webkit-fill-available;
            }
            .logo {
                height: 30px;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        function WhatsAppForm() {
            const [messages, setMessages] = React.useState([
                {
                    text: "**Thank you for joining the fight against diabetes in India!**\n\nBy consenting, you agree to have your comments saved and analyzed, helping researchers design the most innovative diabetes solutions for patients just like you. We will never store or share your name, data, or phone number and all your messages are completely anonymous. Please message \"I consent\" if you agree.",
                    isBot: true,
                    timestamp: new Date()
                }
            ]);
            const [inputText, setInputText] = React.useState("I consent");
            const [hasConsented, setHasConsented] = React.useState(false);
            const [hasGivenFeedback, setHasGivenFeedback] = React.useState(false);

            const handleSend = () => {
                if (!inputText.trim()) return;

                const newMessage = {
                    text: inputText,
                    isBot: false,
                    timestamp: new Date()
                };

                setMessages(prev => [...prev, newMessage]);
                setInputText("");

                if (!hasConsented) {
                    if (inputText.toLowerCase().includes("i consent")) {
                        setHasConsented(true);
                        setTimeout(() => {
                            setMessages(prev => [...prev, {
                                text: "Thank you for consenting! Please tell us how you think researchers can improve diabetes care in India. What specific tools or solutions would be most helpful for diabetes patients?",
                                isBot: true,
                                timestamp: new Date()
                            }]);
                        }, 1000);
                    } else {
                        setTimeout(() => {
                            setMessages(prev => [...prev, {
                                text: "To participate, please type \"I consent\" to agree to having your feedback analyzed.",
                                isBot: true,
                                timestamp: new Date()
                            }]);
                        }, 1000);
                    }
                } else if (!hasGivenFeedback) {
                    setHasGivenFeedback(true);
                    setTimeout(() => {
                        setMessages(prev => [...prev, {
                            text: "Thank you for sharing your valuable feedback! Is there anything else you'd like to add about improving diabetes care in India?",
                            isBot: true,
                            timestamp: new Date()
                        }]);
                    }, 1000);
                } else {
                    setTimeout(() => {
                        setMessages(prev => [...prev, {
                            text: "Thank you for your additional feedback! Your insights will help researchers develop better solutions for diabetes care. Have a great day!",
                            isBot: true,
                            timestamp: new Date()
                        }]);
                    }, 1000);
                }
            };

            return (
                <div style={{
                    display: 'flex',
                    flexDirection: 'column',
                    height: '100vh',
                    maxWidth: '400px',
                    margin: '0 auto',
                    backgroundColor: '#f0f0f0',
                    borderRadius: '8px',
                    overflow: 'hidden',
                    boxShadow: '0 2px 10px rgba(0,0,0,0.1)'
                }}>
                    <div className="logo-container">
                        <img 
                            src="https://research.emory.edu/_includes/images/sections/centers/egdrc/about-egdrc.png"
                            alt="Emory Logo" 
                            className="logo" 
                        />
                        <img 
                            src="https://images1-fabric.practo.com/practices/741414/dr-mohan-s-diabetes-specialities-centre-hyderabad-5d1c9abe366f1.jpg"
                            alt="Dr Mohan's Logo" 
                            className="logo" 
                        />
                        <img 
                            src="https://upload.wikimedia.org/wikipedia/en/thumb/6/69/IIT_Madras_Logo.svg/640px-IIT_Madras_Logo.svg.png"
                            alt="IIT Logo" 
                            className="logo" 
                        />
                    </div>
                    <div className="messages">
                        {messages.map((message, index) => (
                            <div
                                key={index}
                                className={`message ${message.isBot ? 'bot-message' : 'user-message'}`}
                            >
                                {message.text}
                            </div>
                        ))}
                    </div>
                    <div className="input-container">
                        <input
                            type="text"
                            value={inputText}
                            onChange={(e) => setInputText(e.target.value)}
                            onKeyPress={(e) => e.key === 'Enter' && handleSend()}
                            placeholder="Type a message..."
                        />
                        <button onClick={handleSend}>Send</button>
                    </div>
                </div>
            );
        }
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<WhatsAppForm />);
    </script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Diabetes Research Feedback</title>
    
    <!-- React and ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
        }
        input, textarea, select, button {
            font-size: 16px !important;
        }
        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            padding: 12px;
            background-color: #006400;
        }
        .logo {
            height: 35px;
            width: auto;
            object-fit: contain;
        }
        .logo-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .emory-logo {
            background-color: white;
            padding: 4px;
            border-radius: 4px;
        }
        .messages {
            flex-grow: 1;
            overflow-y: auto;
            padding: 10px;
        }
        .message {
            margin: 10px 0;
            padding: 10px;
            border-radius: 8px;
            max-width: 80%;
            white-space: pre-wrap;
        }
        .user-message {
            background-color: #dcf8c6;
            margin-left: auto;
        }
        .bot-message {
            background-color: white;
        }
        .input-container {
            display: flex;
            padding: 10px;
            background-color: white;
            border-top: 1px solid #ddd;
        }
        .input-container input {
            flex-grow: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 20px;
            margin-right: 8px;
        }
        .input-container button {
            padding: 8px 16px;
            background-color: #128C7E;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
        }
        @media screen and (max-width: 768px) {
            body {
                padding: 10px;
                height: -webkit-fill-available;
            }
            .logo {
                height: 25px;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        function WhatsAppForm() {
            const [messages, setMessages] = React.useState([
                {
                    text: "Thank you for joining the fight against diabetes in India!\n\nBy participating, you agree to have your comments saved and analyzed, helping researchers design the most innovative diabetes solutions for patients just like you. We will never store or share your name, data, or phone number and all your messages are completely anonymous. Please message \"I agree\" if you agree.",
                    isBot: true,
                    timestamp: new Date()
                }
            ]);
            const [inputText, setInputText] = React.useState("I agree");
            const [hasConsented, setHasConsented] = React.useState(false);
            const [hasGivenFeedback, setHasGivenFeedback] = React.useState(false);

            const submitToGoogleSheets = async (message) => {
                try {
                    const response = await fetch('YOUR_GOOGLE_APPS_SCRIPT_URL', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            timestamp: new Date().toISOString(),
                            message: message,
                            consentStatus: hasConsented ? 'Agreed' : 'Not Agreed'
                        })
                    });
                    
                    if (!response.ok) {
                        console.error('Failed to submit to Google Sheets');
                    }
                } catch (error) {
                    console.error('Error submitting to Google Sheets:', error);
                }
            };

            const handleSend = () => {
                if (!inputText.trim()) return;

                const newMessage = {
                    text: inputText,
                    isBot: false,
                    timestamp: new Date()
                };

                setMessages(prev => [...prev, newMessage]);
                submitToGoogleSheets(inputText);
                setInputText("");

                if (!hasConsented) {
                    if (inputText.toLowerCase().includes("i agree")) {
                        setHasConsented(true);
                        setTimeout(() => {
                            setMessages(prev => [...prev, {
                                text: "Thank you for agreeing! Please tell us: What is the biggest problem you or your family member is facing in diabetes management? Feel free to write as much as you want.",
                                isBot: true,
                                timestamp: new Date()
                            }]);
                        }, 1000);
                    } else {
                        setTimeout(() => {
                            setMessages(prev => [...prev, {
                                text: "To participate, please type \"I agree\" to agree to having your feedback analyzed.",
                                isBot: true,
                                timestamp: new Date()
                            }]);
                        }, 1000);
                    }
                } else if (!hasGivenFeedback) {
                    setHasGivenFeedback(true);
                    setTimeout(() => {
                        setMessages(prev => [...prev, {
                            text: "Thank you for sharing your valuable feedback! Is there anything else you'd like to add about improving diabetes care in India?",
                            isBot: true,
                            timestamp: new Date()
                        }]);
                    }, 1000);
                } else {
                    setTimeout(() => {
                        setMessages(prev => [...prev, {
                            text: "Thank you for your additional feedback! Your insights will help researchers develop better solutions for diabetes care. Have a great day!",
                            isBot: true,
                            timestamp: new Date()
                        }]);
                    }, 1000);
                }
            };

            return (
                <div style={{
                    display: 'flex',
                    flexDirection: 'column',
                    height: '100vh',
                    maxWidth: '400px',
                    margin: '0 auto',
                    backgroundColor: '#f0f0f0',
                    borderRadius: '8px',
                    overflow: 'hidden',
                    boxShadow: '0 2px 10px rgba(0,0,0,0.1)'
                }}>
                    <div className="logo-container">
                        <div className="logo-wrapper">
                            <img 
                                src="https://i.ibb.co/CpVq3Jvj/blue-EGDRC-logo-with-WHSC-tagline-004.png"
                                alt="Emory Logo" 
                                className="logo emory-logo"
                            />
                        </div>
                        <div className="logo-wrapper">
                            <img 
                                src="https://images1-fabric.practo.com/practices/741414/dr-mohan-s-diabetes-specialities-centre-hyderabad-5d1c9abe366f1.jpg"
                                alt="Dr Mohan's Logo" 
                                className="logo"
                            />
                        </div>
                        <div className="logo-wrapper">
                            <img 
                                src="https://upload.wikimedia.org/wikipedia/en/thumb/6/69/IIT_Madras_Logo.svg/640px-IIT_Madras_Logo.svg.png"
                                alt="IIT Logo" 
                                className="logo"
                            />
                        </div>
                    </div>
                    <div className="messages">
                        {messages.map((message, index) => (
                            <div
                                key={index}
                                className={`message ${message.isBot ? 'bot-message' : 'user-message'}`}
                            >
                                {message.text}
                            </div>
                        ))}
                    </div>
                    <div className="input-container">
                        <input
                            type="text"
                            value={inputText}
                            onChange={(e) => setInputText(e.target.value)}
                            onKeyPress={(e) => e.key === 'Enter' && handleSend()}
                            placeholder="Type a message..."
                        />
                        <button onClick={handleSend}>Send</button>
                    </div>
                </div>
            );
        }
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<WhatsAppForm />);
    </script>
</body>
</html>
